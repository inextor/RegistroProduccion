<div class="container mt-4">
	<h2>Resumen de Producción</h2>

	<div class="row">
		<div class="col-md-4">
			<div class="form-group">
				<label>Inicio</label>
				<input type="date" class="form-control" name="start_date" [(ngModel)]="start_date">
			</div>
		</div>
		<div class="col-md-4">
			<div class="form-group">
				<label>Fin</label>
				<input type="date" class="form-control" name="end_date" [(ngModel)]="end_date">
			</div>
		</div>
		<div class="col-md-4">
			<button class="btn btn-primary" (click)="search($event)">Buscar</button>
		</div>
	</div>

	@if (is_loading)
	{
		<p>Cargando...</p>
	}
	@else
	{
		<table class="table table-bordered">
			<tr>
				<th>Equipos/Categorias/Articulos/Parciales</th>
				<th>Kgs</th>
				<th>Piezas</th>
				<th></th>
			</tr>
		</table>

		@for (area_data of production_by_area_list; track area_data.production_area.id)
		{

			<table class="table table-bordered">
				<tr>
					<th>{{ area_data.production_area.name }}</th>
					<th>{{area_data.total_kgs}}</th>
					<th>{{area_data.total_pieces}}</th>
					<th>
						<button (click)="area_data.open = !area_data.open">Toggle</button>
					</th>
				</tr>
				@if(area_data.open)
				{
					@for (category_data of area_data.production_by_category; track category_data.category_name)
					{
						<tr class="table-info">
							<td>
								<strong>{{category_data.category_name}}</strong>
							</td>
							<td>
								<strong>{{ category_data.total_kgs  }}</strong>
							</td>
							<td>
								<strong>{{ category_data.total_pieces }}</strong>
							</td>
							<td>
								<button (click)="category_data.open = !category_data.open">Toggle</button>
							</td>
						</tr>

						@if(category_data.open)
						{
							@for (item_data of category_data.production_by_item; track item_data.item.id)
							{
								<tr>
									<td>{{ item_data.item.name }}</td>
									<td>{{ item_data.total_kgs}}</td>
									<td>{{ item_data.total_pieces }}</td>
									<td>
										<button (click)="item_data.open = !item_data.open"> Toggle </button>
									</td>
								</tr>
								@if(item_data.open)
								{
									@for (production_info of item_data.production_info_list; track production_info.id)
									{
										<tr>
											<td></td>
											<td>{{production_info.production.qty}}</td>
											<td>{{production_info.production.alternate_qty}}</td>
											<td></td>
										</tr>
									}
								}
							}
						}
					}
				}
			</table>
		}

		<table class="table table-bordered">
			<thead>
				<tr>
					<th></th>
					<th>Total Kgs</th>
					<th>Total Piezas</th>
					<th></th>
				</tr>
			</thead>

			<tfoot>
				<tr class="table-primary">
					<td><strong>Total Área</strong></td>
					<td><strong>{{ total_kgs  }}</strong></td>
					<td><strong>{{ total_pieces  }}</strong></td>
					<td></td>
				</tr>
			</tfoot>
		</table>
	}
</div>
